## 7.0.0

_Released 03/29/2021_

**Summary:**

**Breaking Changes:**

**<Icon name="exclamation-triangle" color="red"></Icon> Please read our [Migration Guide](/guides/references/migration-guide) which explains the changes in more detail and how to change your code to migrate to Cypress 7.0.**

- Request handlers supplied to cy.intercept are now matched starting with the most-recently-defined request interceptor. This allows users to override request handlers by calling cy.intercept again. This matches the previous behavior that was standard in cy.route. Addresses [#9302](https://github.com/cypress-io/cypress/issues/9302).
- Cypress now catches uncaught errors and fails the test even if the application under test has defined `window.onerror`. Addresses [#8802](https://github.com/cypress-io/cypress/pull/8802)
- Cypress now fails tests if there is an unhandled promise rejection in the application under test. Unhandled rejections will trigger the `uncaught:exception` event with the promise as the third argument. Addresses [#243](https://github.com/cypress-io/cypress/issues/243)
- Cypress now throws an error if the application under test redirects more than 20 times. The number of times allowed to redirect is configurable via the `redirectionLimit` config. Addresses [#14445](https://github.com/cypress-io/cypress/issues/14445).
- `Cypress.moment()` has been removed. Please migrate to a different datetime formatter. See [our recipe](https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/blogs__dayjs) for example replacements. Addresses [#8714](https://github.com/cypress-io/cypress/issues/8714).
- cy.route2 was previously aliased to cy.intercept. Now the alias cy.route2 has been removed. Please update usage of cy.route2 to cy.intercept. Addressed in [#14709](https://github.com/cypress-io/cypress/pull/14709).
- Installing Cypress on your system now requires Node.js 12+. Addresses [#9545](https://github.com/cypress-io/cypress/issues/9545).
- Reverted "The delayMs option for StaticResponses used with cy.intercept has been renamed to delay." [#15255](https://github.com/cypress-io/cypress/issues/15255)

**Deprecations:**

Deprecations still work as before but will be removed from Cypress in a future release. We encourage you to update your code now to remove uses of deprecations.

**Features:**

- We added several features to [cy.intercept()](/api/commands/intercept). See the [cy.intercept()](/api/commands/intercept) docs for full usage examples. Addressed in [#14543](https://github.com/cypress-io/cypress/pull/14543). New features:
  - There are now new events on the req object for `cy.intercept`: `before:response`, `response`, and `after:response`.
  - Response handlers (supplied via event handlers or via `req.continue(cb)`) supplied to `cy.intercept()` will be called in reverse order until `res.send` is called or until there are no more response handlers.
  - A new option, middleware, has been added to the RouteMatcher type. If true, the supplied request handler will be called before any non-middleware request handlers.
  - A new function, `req.continue(cb)`, is available on request objects yielded by `cy.intercept()`. It is functionally the same as `req.reply(cb)` - the request will stop propagating to other event handlers, will be sent outgoing, and the response will be handled by cb.
  - `cy.intercept()` can now be called with a new overload: `cy.intercept(url, routeMatcher, handler)`. `routeMatcher` will be merged with `url`, and the handler is required.
- feat: Target modern ES with default preprocessor https://github.com/cypress-io/cypress/issues/15274

**Bugfixes:**

- Fixed an issue where the `response.body` of `cy.intercept()` would be incorrect after stubbing a response using `res.send({ fixture })` in a `req.continue` callback or a `before:response` or `response` handler. Addressed in [#14543](https://github.com/cypress-io/cypress/pull/14543).
- fix(driver): fixed an issue with tests not failing for scripts with custom window.onerror https://github.com/cypress-io/cypress/issues/9077
- Yield object instead of string in cy.wait when request content-type is valid JSON Mime type (not only application/json) https://github.com/cypress-io/cypress/issues/14763
- Studio button is not displayed properly when a test has a long title https://github.com/cypress-io/cypress/issues/15182
- Response not coming through for every request with intercept https://github.com/cypress-io/cypress/issues/14522
- Static replies in Intercept drop falsy values https://github.com/cypress-io/cypress/issues/15234
- cy.wait for alias registered to non-first matching cy.intercept does not have response property (body & status) https://github.com/cypress-io/cypress/issues/14205
- Global app + spec error handling is inconsistent https://github.com/cypress-io/cypress/issues/8236
- Wrong typing for Response.headers that is returned by cy.request https://github.com/cypress-io/cypress/issues/14842
- fix: enable contextIsolation by default in Electron https://github.com/cypress-io/cypress/issues/15493
- [Cypress 6.0.0] Overriding interceptors doesn't work. https://github.com/cypress-io/cypress/issues/9302
- cy.intercept / force404 https://github.com/cypress-io/cypress/issues/15209
- feat: make cy.intercept url matching more closely match cy.route https://github.com/cypress-io/cypress/issues/15647
- fix(reporter): Improve layout of Reporter Header https://github.com/cypress-io/cypress/issues/15640

**Documentation Changes:**

- Our [Migration Guide](/guides/references/migration-guide) has a new section for 7.0 migration.

**Misc:**

**Dependency Updates**

- Upgraded `electron` from `11.3.0` to `12.0.0`. Addressed in [#15292](https://github.com/cypress-io/cypress/pull/15292).
